# general
host: 0.0.0.0
port: 9091
theme: dark
jwt_secret: '{{ auth_jwt_secret }}'
default_redirection_url: 'https://{{ 'go.' if ansible_play_name == 'gitlab' }}{{ domain }}'
totp:
  issuer: '{{ domain }}'
log_file_path: /var/log/authelia.log

authentication_backend:
  disable_reset_password: true
  file:
    path: /config/users.yml
    password:
      algorithm: sha512
      iterations: 1
      salt_length: 16
      parallelism: 8
      memory: 128

access_control:
  default_policy: deny
  {% if ansible_play_name == 'network' -%}
  rules:
    - domain:
        - portainer.{{ domain }}
        - unifi.{{ domain }}
      policy: bypass
    - domain:
        - prometheus.{{ domain }}
      resources:
        - /-/reload
      policy: bypass
    - domain:
        - pihole.{{ domain }}
      resources:
        - ^\/+api\.php
      policy: bypass
    - domain:
        - dozzle.{{ domain }}
        - traefik.{{ domain }}
        - prometheus.{{ domain }}
        - grafana.{{ domain }}
        - pihole.{{ domain }}
        - homeassistant.{{ domain }}
      policy: two_factor
  {% elif ansible_play_name == 'gitlab' -%}
  rules:
    - domain:
        - portainer.{{ domain }}
        - git.{{ domain }}
        - registry.{{ domain }}
      policy: bypass
    - domain:
        - code.{{ domain }}
        - logs.{{ domain }}
        - links.{{ domain }}
        - traefik.{{ domain }}
        - stats.{{ domain }}
        - docs.{{ domain }}
      policy: two_factor
  {% else -%}
  rules: {{ '[]' -}}
  {%- endif %}

session:
  name: authelia_session
  domain: '{{ domain }}'
  secret: '{{ auth_session_secret }}'
  expiration: 42h
  inactivity: 15m

regulation:
  max_retries: 3
  find_time: 120
  ban_time: 300

storage:
  local:
    path: /config/db.sqlite3

notifier:
  smtp:
    host: '{{ mail.host }}'
    port: '{{ mail.port }}'
    username: '{{ mail.accounts.auth.email }}'
    password: '{{ mail.accounts.auth.password }}'
    sender: '{{ mail.accounts.auth.email }}'
    identifier: localhost
    subject: "[auth@{{ ansible_play_name }}] {title}"
    startup_check_address: '{{ auth_username }}'
    disable_require_tls: false
    disable_html_emails: false
    tls:
      skip_verify: false
      minimum_version: TLS1.2
